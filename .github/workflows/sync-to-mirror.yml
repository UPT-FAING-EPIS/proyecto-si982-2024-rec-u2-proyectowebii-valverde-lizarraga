name: Sync to Mirror Repo

on:
  push:
    paths:
      - 'GestionReservasWebII/**'
      - '*.sln'  # Si se actualiza la solución
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout del código
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Configurar Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Agregar el repositorio espejo como remoto
        run: |
          git remote add mirror ${{ secrets.REPO_ESPEJO }}
          git fetch mirror || echo "No se pudo recuperar el remoto, es posible que aún no exista."

      - name: Filtrar solo los archivos necesarios
        run: |
          git checkout -b sync-branch
          git filter-branch --prune-empty --subdirectory-filter GestionReservasWebII HEAD

      - name: Agregar y hacer commit de cambios
        run: |
          git add .
          git commit -m "Sync: Actualización de GestionReservasWebII y archivos de solución" || echo "No hay cambios para enviar"

      - name: Enviar cambios al repositorio espejo
        run: |
          git push --force mirror sync-branch:main
